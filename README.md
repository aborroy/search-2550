# Deployment for Sizing Guide Data Generator process using ACS 7 and Elasticsearch

This project describes the process to generate volumes of random documents with associated metadata (in local filesystem or S3 Bucket) and the bulk ingestion of this content into an ACS 7 deployment using Elasticsearch as Search Service.

The tools used in the process are provided by the Performance Team and are also used as base for the Sizing Guide.

Following projects are required:

* Generation of documents and metadata in local environment (file system or S3): [https://github.com/Alfresco/sizing-guide-data-generator](https://github.com/Alfresco/sizing-guide-data-generator)
* Alfresco Repository Web Script API to ingest documents generated by the Data Generator project: [https://gitlab.alfresco.com/performance-benchmarking-framework/bulk-object-mapper/tree/master](https://gitlab.alfresco.com/performance-benchmarking-framework/bulk-object-mapper/tree/master)

>> You need Alfresco Partner credentials in order to access the code of these projects

Additionally an ACS Deployment (Docker Compose for this use case) is required.

>> You need Alfresco Partner credentials in order to access the Docker Images used, as they are hosted in quay.io repository



## Deploy ACS 7 and Elasticsearch

https://gitlab.alfresco.com/performance-benchmarking-framework/bulk-object-mapper/tree/master

[docker-compose.yml](docker-compose.yml)

```
.
├── alfresco
│   ├── Dockerfile
│   └── modules
│       ├── amps
│       └── jars
│           └── bulkObjectMapper-1.0.7-SNAPSHOT.jar
└── docker-compose.yml
```

Start Docker Compose deployment.

```
$ docker-compose up --build --force-recreate
```

Following services will be available:

* Alfresco Repository http://localhost:8080/alfresco
* Alfresco Digital Workspace http://localhost:8080/
* Kibana http://localhost:5601


Module BulkObjectMapper is deployed in Repository service, providing following Web Scripts:

```
/bulkfsimport
/bulkfsimport/ajax/suggest/inplacestores
/bulkfsimport/ajax/suggest/spaces
/bulkfsimport/initiate
/bulkfsimport/inplace
/bulkfsimport/inplace/initiate
/bulkfsimport/status
/bulkobj/checkobjects
/bulkobj/cmd
/bulkobj/mapobjects
/bulkobj/mapobjects/{uuid}
/bulkobj/removeItems
/bulkobj/stat/{uuid}
/bulkobj/stats
/bulkobj/typeinfo/{typename}
```


## Create the DataSet

Sizing Guide Data Generator project is used to generate documents and metadata.

Checkout the repository from GitHub.

```
$ git clone git@github.com:Alfresco/sizing-guide-data-generator.git

$ cd sizing-guide-data-generator
```

Build the Docker Images to generate documents, metadata and JSON Requests.

```
$ docker build -f file-generator/Dockerfile -t file-generator:latest .

$ docker build -f metadata-generator/Dockerfile -t metadata-generator:latest .

$ docker build -f json-generator/Dockerfile -t json-generator:latest .
```

Generate 1,000,000 random metadata in `generated/metadata` local folder.

```
$ mkdir -p generated/metadata
$ docker run -v $PWD/generated/metadata:/metadata --rm -t metadata-generator 1000000 1
```

Generate 10 random document for each type in `generated/files` local folder.

```
$ mkdir -p generated/files
$ docker run -e count=10 -v $PWD/generated/files:/files --rm -t file-generator
```

Generate JSON Request for 100,000 metadata values and files.

```
$ mkdir -p generated/json
$ docker run -v $PWD/generated/files:/files -v $PWD/generated/metadata:/metadata -v $PWD/generated/json:/json --rm -t json-generator 20 20 20 20 20 100000 100 cm 1
```


## Bulk importing process

```
$ curl -uadmin:admin \
--data @/Users/aborroy/Desktop/git/sizing-guide-data-generator/generated/json/docx20_pptx20_pdf20_jpg20_txt20_metadataId1/0/20e471ef-a049-4941-81ac-69b969c62792.json \
http://localhost:8080/alfresco/s/bulkobj/mapobjects/ae529a14-968f-4c44-b532-2b413a6edacb\?autoCreate\=y -X POST -H "Content-Type: application/json"
```
